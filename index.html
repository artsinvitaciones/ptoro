<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intro Interactiva</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: black;
      font-family: sans-serif;
    }

    video {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #video0 { z-index: 3; }
    .video-step { z-index: 2; display: none; }
    .video-step.active { display: block; }

    .continue-button, .final-buttons {
      position: absolute;
      bottom: 30px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 4;
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition: opacity 1s ease;
    }

    .continue-button.enabled, .final-buttons.enabled {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }

    .continue-button button {
      padding: 10px 20px;
      font-size: 18px;
      background: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .buttons-container {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
    }

    .button-img {
      width: 60px;
      cursor: pointer;
      transition: opacity 0.3s ease;
    }

    .button-img:hover { opacity: 0.8; }
    .inactive-link { pointer-events: none; }

    #unsupported-browser, #start-fallback {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: black;
      z-index: 9999;
      display: none;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
      color: white;
    }

    @media (max-width: 480px) {
      .button-img { width: 50px; }
    }
    @media (min-width: 481px) and (max-width: 768px) {
      .button-img { width: 60px; }
    }
    @media (min-width: 769px) {
      .button-img { width: 70px; }
    }
  </style>
</head>
<body oncontextmenu="return false">

  <!-- Navegador no compatible -->
  <div id="unsupported-browser">
    <div>
      <p>‚ö†Ô∏è Lo sentimos üò¢</p>
      <p>Tu navegador no es compatible con esta experiencia interactiva.</p>
      <p>Usa Google Chrome o Firefox.</p>
    </div>
  </div>

  <!-- Fallback para autoplay bloqueado -->
  <div id="start-fallback">Toca para comenzar</div>

  <!-- Video Intro -->
  <video id="video0" autoplay playsinline muted preload="auto">
    <source src="assets/video0.mp4" type="video/mp4" />
  </video>

  <!-- Videos Interactivos -->
  <video id="video1" class="video-step" playsinline muted preload="auto">
    <source src="assets/video1.mp4" type="video/mp4" />
  </video>
  <video id="video2" class="video-step" playsinline muted preload="auto">
    <source src="assets/video2.mp4" type="video/mp4" />
  </video>
  <video id="video3" class="video-step" playsinline muted preload="auto">
    <source src="assets/video3.mp4" type="video/mp4" />
  </video>
  <video id="video4" class="video-step" playsinline muted preload="auto">
    <source src="assets/video4.mp4" type="video/mp4" />
  </video>

  <!-- Video final -->
  <video id="video5" class="video-step" playsinline loop muted preload="auto" style="display: none;">
    <source src="assets/video5.mp4" type="video/mp4" />
  </video>

  <!-- M√∫sica -->
  <audio id="audio" loop preload="auto">
    <source src="assets/music.mp3" type="audio/mpeg" />
  </audio>

  <!-- Bot√≥n Comenzar (nuevo) -->
  <div class="continue-button" id="start-button">
    <button>Comenzar</button>
  </div>

  <!-- Bot√≥n Continuar (ya estaba) -->
  <div class="continue-button" id="continue-button">
    <button>Continuar</button>
  </div>

  <!-- Botones Finales -->
  <div class="final-buttons" id="final-buttons">
    <div class="buttons-container">
      <div>
        <a href="https://maps.app.goo.gl/iLidSW6oDsJFU3Z18" target="_blank">
          <img src="assets/salon.png" class="button-img" alt="Sal√≥n" />
        </a>
      </div>
      <div>
        <a href="https://api.whatsapp.com/send?phone=+59175200294&text=Hola%20quiero%20confirmar%20mi%20asistencia" target="_blank">
          <img src="assets/botonasistencia.png" class="button-img" alt="Confirmar asistencia" />
        </a>
      </div>
      <div>
        <img src="assets/repetir.png" class="button-img" alt="Repetir" id="repeat-button" />
      </div>
    </div>
  </div>

  <script>
    const ua = navigator.userAgent.toLowerCase();
    const isXiaomi = /miuibrowser|miui|miwebview/.test(ua);

    const fallback = document.getElementById("start-fallback");
    const unsupported = document.getElementById("unsupported-browser");

    const video0 = document.getElementById("video0");
    const videos = [
      document.getElementById("video1"),
      document.getElementById("video2"),
      document.getElementById("video3"),
      document.getElementById("video4")
    ];
    const video5 = document.getElementById("video5");

    const audio = document.getElementById("audio");
    const startBtn = document.getElementById("start-button");
    const continueBtn = document.getElementById("continue-button");
    const finalButtons = document.getElementById("final-buttons");
    const repeatBtn = document.getElementById("repeat-button");

    if (isXiaomi) {
      unsupported.style.display = "flex";
      video0.style.display = "none";
      videos.forEach(v => v.style.display = "none");
      video5.style.display = "none";
      audio.remove();
      startBtn.remove();
      continueBtn.remove();
      finalButtons.remove();
    } else {
      window.addEventListener("load", () => {
        video0.play().catch(() => {
          fallback.style.display = "flex";
          fallback.addEventListener("click", () => {
            video0.play().then(() => fallback.style.display = "none");
          });
        });
      });

      video0.addEventListener("ended", () => {
        video0.style.display = "none";
        const video = videos[0]; // video1
        video.classList.add("active");
        video.muted = false;
        video.pause();
        video.currentTime = 0;
        startBtn.classList.add("enabled");
      });

      startBtn.querySelector("button").onclick = () => {
        startBtn.classList.remove("enabled");
        const video = videos[0]; // video1
        video.play();
        audio.play();

        video.addEventListener("ended", () => {
          showContinue(() => {
            video.classList.remove("active");
            playVideoStep(1);
          });
        }, { once: true });
      };

      function playVideoStep(index) {
        const video = videos[index];
        video.classList.add("active");
        video.muted = false;
        video.play();

        if (index === 0) audio.play();
        if (index === 3) {
          video5.currentTime = 0;
          video5.play();
        }

        video.addEventListener("ended", () => {
          if (index < videos.length - 1) {
            showContinue(() => {
              video.classList.remove("active");
              playVideoStep(index + 1);
            });
          } else {
            video.classList.remove("active");
            video5.style.display = "block";
            video5.classList.add("active");
            showFinalButtons();
          }
        }, { once: true });
      }

      function showContinue(callback) {
        continueBtn.classList.add("enabled");
        const btn = continueBtn.querySelector("button");
        btn.onclick = () => {
          continueBtn.classList.remove("enabled");
          callback();
        };
      }

      function showFinalButtons() {
        finalButtons.classList.add("enabled");
      }

      repeatBtn.addEventListener("click", () => {
        finalButtons.classList.remove("enabled");
        videos.forEach(v => {
          v.pause();
          v.currentTime = 0;
          v.classList.remove("active");
        });
        video5.pause();
        video5.currentTime = 0;
        video5.style.display = "none";
        video5.classList.remove("active");

        audio.pause();
        audio.currentTime = 0;

        video0.currentTime = 0;
        video0.style.display = "block";
        video0.play().catch(() => {
          fallback.style.display = "flex";
        });
      });

      document.addEventListener('contextmenu', e => e.preventDefault());
    }
  </script>
</body>
</html>
